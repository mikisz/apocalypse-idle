import { SHELTER_COST_GROWTH, SHELTER_MAX } from './settlement.js';

export const BUILDINGS = [
  {
    id: 'potatoField',
    name: 'Potato Field',
    type: 'production',
    category: 'Food',
    outputsPerSecBase: { potatoes: 0.375 },
    costBase: { wood: 15 },
    costGrowth: 1.15,
    refund: 0.5,
    description: 'Reliable staple crop. Strongly affected by seasons.',
  },
  {
    id: 'loggingCamp',
    name: 'Logging Camp',
    type: 'production',
    category: 'Production',
    outputsPerSecBase: { wood: 0.2 },
    costBase: { scrap: 15 },
    costGrowth: 1.15,
    refund: 0.5,
    description: 'Steady wood income. Slight weather impact.',
  },
  {
    id: 'scrapyard',
    name: 'Scrap Yard',
    type: 'production',
    category: 'Production',
    outputsPerSecBase: { scrap: 0.06 },
    costBase: { wood: 12 },
    costGrowth: 1.15,
    refund: 0.5,
    description: 'Collects scrap from nearby ruins.',
  },
  {
    id: 'quarry',
    name: 'Quarry',
    type: 'production',
    category: 'Production',
    outputsPerSecBase: { stone: 0.08 },
    costBase: { wood: 20, scrap: 5 },
    costGrowth: 1.15,
    refund: 0.5,
    description: 'Extracts stone slowly but steadily.',
  },
  {
    id: 'sawmill',
    name: 'Sawmill',
    type: 'processing',
    category: 'Production',
    requiresResearch: 'industry1',
    inputsPerSecBase: { wood: 1 },
    outputsPerSecBase: { planks: 0.5 },
    costBase: { wood: 40, scrap: 15, stone: 10 },
    costGrowth: 1.15,
    refund: 0.5,
    seasonProfile: 'constant',
    description: 'Converts wood into planks.',
  },
  {
    id: 'metalWorkshop',
    name: 'Metal Workshop',
    type: 'processing',
    category: 'Production',
    requiresResearch: 'industry1',
    inputsPerSecBase: { scrap: 1 },
    outputsPerSecBase: { metalParts: 0.4 },
    costBase: { wood: 30, scrap: 30, stone: 10, planks: 10 },
    costGrowth: 1.15,
    refund: 0.5,
    seasonProfile: 'constant',
    description: 'Processes scrap into metal parts.',
  },
  {
    id: 'school',
    name: 'School',
    type: 'production',
    category: 'Science',
    outputsPerSecBase: { science: 0.5 },
    costBase: { wood: 25, scrap: 10, stone: 10 },
    costGrowth: 1.15,
    refund: 0.5,
    description: 'Provides basic education and generates science.',
  },
  {
    id: 'woodGenerator',
    name: 'Wood Generator',
    type: 'production',
    category: 'Energy',
    outputsPerSecBase: { power: 1 },
    inputsPerSecBase: { wood: 0.3 },
    costBase: { wood: 50, stone: 10 },
    costGrowth: 1.15,
    refund: 0.5,
    requiresResearch: 'basicEnergy',
    description:
      'Burns wood to generate power. Excess power is lost if storage is full.',
  },
  {
    id: 'shelter',
    name: 'Shelter',
    type: 'production',
    category: 'Settlement',
    costBase: { wood: 30, scrap: 10 },
    costGrowth: SHELTER_COST_GROWTH,
    refund: 0.5,
    maxCount: SHELTER_MAX,
    description: 'Houses one settler. Max: 5',
  },
  {
    id: 'radio',
    name: 'Radio',
    type: 'production',
    category: 'Utilities',
    inputsPerSecBase: { power: 0.1 },
    costBase: { wood: 80, scrap: 40, stone: 20 },
    costGrowth: 1,
    refund: 0.5,
    maxCount: 1,
    description: 'Requires power to operate. Attracts settlers over time.',
  },
  {
    id: 'foodStorage',
    name: 'Granary',
    type: 'storage',
    costBase: { wood: 20, scrap: 5, stone: 5 },
    costGrowth: 1.15,
    refund: 0.5,
    capacityAdd: { potatoes: 300 },
    description: 'Increases storage for harvested crops.',
  },
  {
    id: 'rawStorage',
    name: 'Warehouse',
    type: 'storage',
    costBase: { wood: 25, scrap: 10, stone: 10 },
    costGrowth: 1.15,
    refund: 0.5,
    capacityAdd: { wood: 200, stone: 80, scrap: 120 },
    description: 'Increases storage for wood, stone and scrap.',
  },
  {
    id: 'materialsDepot',
    name: 'Materials Depot',
    type: 'storage',
    requiresResearch: 'industry1',
    costBase: { wood: 25, scrap: 10, stone: 5 },
    costGrowth: 1.15,
    refund: 0.5,
    capacityAdd: { planks: 150, metalParts: 60 },
    description: 'Stores processed construction materials.',
  },
  {
    id: 'battery',
    name: 'Battery',
    type: 'storage',
    costBase: { wood: 40, stone: 20 },
    costGrowth: 1.15,
    refund: 0.5,
    capacityAdd: { power: 20 },
    requiresResearch: 'basicEnergy',
    description: 'Allows storing more generated Power.',
  },
];

export const BUILDING_MAP = Object.fromEntries(BUILDINGS.map((b) => [b.id, b]));
export const PRODUCTION_BUILDINGS = BUILDINGS.filter(
  (b) => b.type === 'production' || b.type === 'processing',
);
export const STORAGE_BUILDINGS = BUILDINGS.filter((b) => b.type === 'storage');

export function getBuildingCost(building, countBuilt) {
  const factor = Math.pow(building.costGrowth, countBuilt);
  const result = {};
  Object.entries(building.costBase).forEach(([res, amt]) => {
    result[res] = Math.ceil(amt * factor);
  });
  return result;
}
